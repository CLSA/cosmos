<org.obiba.magma.views.View>
  <name>QC_F2</name>
  <from class="org.obiba.magma.views.JoinTable">
    <list>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.Participants</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.BloodPressure</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.CognitiveTest</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.CarotidIntima</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.DualHipBoneDensity</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.ECG</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.ForearmBoneDensity</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.GripStrength</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.Hearing</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.LateralBoneDensity</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.RetinalScanLeft</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.RetinalScanRight</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.Spirometry</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.Tonometer</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.Weight</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.WholeBodyBoneDensity</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.StandingHeight</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-images-f2.SpineBoneDensity</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.ChairRise</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.HipsWaist</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.TUG</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.StandingBalance</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.4mWalk</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.StroopFAS</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.SittingHeight</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-dcs-f2.VisionAcuity</reference>
      </table>
    </list>
  </from>
  <select class="org.obiba.magma.views.support.NoneClause"/>
  <where class="org.obiba.magma.js.views.JavascriptClause">
    <scriptName>customScript</scriptName>
    <script>$lastupdate().before(newValue(&apos;2018-06-21&apos;,&apos;date&apos;)).and($lastupdate().after(newValue(&apos;2015-04-01&apos;,&apos;date&apos;)))</script>
  </where>
  <variables class="org.obiba.magma.js.views.VariablesClause">
    <variables class="linked-hash-set">
      <variable name="stage_technician_spirometry" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="stage" valueType="text">Spirometry</attribute>
          <attribute name="derivedFrom" namespace="opal" valueType="text">/datasource/clsa-dcs/table/Spirometry/variable/InstrumentRun.user</attribute>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.Spirometry:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;Spirometry&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="interview_site" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;Admin.ApplicationConfiguration.siteName&apos;).map({
  &apos;BritishColumbia&apos;:&apos;University of BC DCS&apos;,
  &apos;British Columbia&apos;:&apos;University of BC DCS&apos;,
  &apos;Calgary&apos;:&apos;Calgary DCS&apos;,
  &apos;Dalhousie&apos;:&apos;Dalhousie DCS&apos;,
  &apos;Hamilton&apos;:&apos;Hamilton DCS&apos;,
  &apos;Manitoba&apos;:&apos;Manitoba DCS&apos;,
  &apos;McGill&apos;:&apos;McGill DCS&apos;,
  &apos;McMaster&apos;:&apos;Hamilton DCS&apos;,
  &apos;Memorial&apos;:&apos;Memorial DCS&apos;,
  &apos;Memorial University&apos;:&apos;Memorial DCS&apos;,
  &apos;Ottawa&apos;:&apos;Ottawa DCS&apos;,
  &apos;Sherbrooke&apos;:&apos;Sherbrooke DCS&apos;,
  &apos;Simon Fraser&apos;:&apos;Simon Fraser DCS&apos;,
  &apos;SimonFraser&apos;:&apos;Simon Fraser DCS&apos;,
  &apos;UniversityofBC&apos;:&apos;University of BC DCS&apos;,
  &apos;University of Manitoba&apos;:&apos;Manitoba DCS&apos;,
  &apos;University of Victoria&apos;:&apos;Victoria DCS&apos;,
  &apos;Victoria&apos;:&apos;Victoria DCS&apos;},null) </attribute>
        </attributes>
      </variable>
      <variable name="data_missing_spirometry" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Spirometry&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_spirometry&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_spirometry" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;Spirometry&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;Spirometry&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_spirometry" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Spirometry&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="interview_start_date" valueType="date" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="derivedFrom" namespace="opal" valueType="text">/datasource/clsa-dcs/table/Participants/variable/Admin.Interview.startDate</attribute>
          <attribute name="script" valueType="text">$(&apos;Admin.Interview.startDate&apos;)</attribute>
        </attributes>
      </variable>
      <variable name="interview_barcode" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="identifier" valueType="text">true</attribute>
          <attribute name="derivedFrom" namespace="opal" valueType="text">/datasource/clsa-dcs/table/Participants/variable/Admin.Participant.barcode</attribute>
          <attribute name="script" valueType="text">$(&apos;Admin.Participant.barcode&apos;)</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_spirometry" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="stage" valueType="text">Spirometry</attribute>
          <attribute name="validation" valueType="text">[IntegrityCheck-ERROR]</attribute>
          <attribute name="captureMethod" valueType="text">AUTOMATIC</attribute>
          <attribute name="isManualCaptureAllowed" valueType="text">true</attribute>
          <attribute name="vendorName" valueType="text">QUALITY_GRADE</attribute>
          <attribute name="derivedFrom" namespace="opal" valueType="text">/datasource/clsa-dcs/table/Spirometry/variable/OUTPUT_QUALITY_GRADE</attribute>
          <attribute name="script" valueType="text">var res=$(&apos;clsa-dcs-f2.Spirometry:OUTPUT_QUALITY_GRADE&apos;)
if(!res.isNull().value()) {
  res=newValue(&apos;{grade:&apos;+res.value()+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_grip_strength" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.GripStrength:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;GripStrength&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_grip_strength" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;GripStrength&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_grip_strength" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;GripStrength&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;GripStrength&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_grip_strength" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;GripStrength&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_grip_strength&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_grip_strength" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=null
if($(&apos;clsa-dcs-f2.GripStrength:Measure.RES_TRIAL_MAX&apos;).isNull().not().value()) {
  res=newValue(&apos;{trial_count:&apos;+$(&apos;clsa-dcs-f2.GripStrength:Measure.RES_TRIAL_MAX&apos;).size()+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_blood_pressure" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.BloodPressure:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;BloodPressure&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_blood_pressure" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;BloodPressure&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_blood_pressure" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;BloodPressure&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;BloodPressure&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_blood_pressure" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;BloodPressure&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_blood_pressure&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_blood_pressure" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=null
if($(&apos;clsa-dcs-f2.BloodPressure:RES_AVG_COUNT&apos;).isNull().not().value()) {
  res=newValue(&apos;{trial_count:&apos;+$(&apos;clsa-dcs-f2.BloodPressure:RES_AVG_COUNT&apos;)+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_ecg" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.ECG:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;ECG&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_ecg" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ECG&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_ecg" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;ECG&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;ECG&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_ecg" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ECG&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_ecg&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_ecg" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var f=$(&apos;clsa-dcs-f2.ECG:RES_XML_FILE&apos;)
var q=$(&apos;clsa-dcs-f2.ECG:RES_DIAGNOSIS&apos;)
var res=null
if(f.isNull().not().value()) {
  var str=&apos;{file_size:&apos;+f.length()+&apos;,quality:&apos;
  if(q.lowerCase().matches(/poor data quality/).value()) {
    str += &apos;0}&apos;
  } else {
    str += &apos;1}&apos;  
  }
  res = newValue(str,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_cognitive_test" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.CognitiveTest:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;CognitiveTest&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_cognitive_test" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;CognitiveTest&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_cognitive_test" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;CognitiveTest&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;CognitiveTest&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_cognitive_test" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;CognitiveTest&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_cognitive_test&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_cognitive_test" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=$(&apos;clsa-dcs-f2.CognitiveTest:RES_RESULT_FILE&apos;)
if(res.isNull().not().value()) {
  res = newValue(&apos;{filesize:&apos;+res.length()+&apos;}&apos;,&apos;text&apos;)
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_hearing" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.Hearing:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;Hearing&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_hearing" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Hearing&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_hearing" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;Hearing&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;Hearing&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_hearing" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Hearing&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_hearing&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_hearing" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var side = [&apos;RIGHT&apos;,&apos;LEFT&apos;]
var freq = [&apos;1KT&apos;,&apos;500&apos;,&apos;1K&apos;,&apos;2K&apos;,&apos;3K&apos;,&apos;4K&apos;,&apos;6K&apos;,&apos;8K&apos;]
var count = {RIGHT:0,LEFT:0}
var countfreq = {RIGHT:0,LEFT:0}
var counterr = {RIGHT:0,LEFT:0}
for(var i=0;i&lt;side.length;i++) {
  var s = side[i]
  var v = &apos;clsa-dcs-f2.Hearing:RES_&apos; + s + &apos;_&apos;
  for(var j=0;j&lt;freq.length;j++) {
    var f = v + freq[j]
    if ($(f).isNull().not().or($(f + &apos;_ERR&apos;).isNull().not()).value()) count[s]++;
    if ($(f).isNull().not().value()) countfreq[s]++;
    if ($(f + &apos;_ERR&apos;).isNull().not().value()) counterr[s]++;
  }
}
res = (0 == count.RIGHT &amp;&amp; 0 == count.LEFT &amp;&amp; 
  $(&apos;clsa-dcs-f2.Hearing:RES_TEST_ID&apos;).isNull().and(
    $(&apos;clsa-dcs-f2.Hearing:RES_TEST_DATETIME&apos;).isNull()).value()) ?
      null : newValue(
        &apos;{response_left:&apos;+count.LEFT+
        &apos;,response_right:&apos;+count.RIGHT+
        &apos;,error_left:&apos;+(counterr.LEFT&gt;0 &amp;&amp; countfreq.LEFT==0 ? &apos;1&apos; : &apos;0&apos;)+
        &apos;,error_right:&apos;+(counterr.RIGHT&gt;0 &amp;&amp; countfreq.RIGHT==0 ? &apos;1&apos; : &apos;0&apos;)+
        &apos;}&apos;,&apos;text&apos;)</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_tonometer" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.Tonometer:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;Tonometer&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_tonometer" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Tonometer&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_tonometer" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;Tonometer&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;Tonometer&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_tonometer" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Tonometer&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_tonometer&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_tonometer" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var eye=$(&apos;clsa-dcs-f2.Tonometer:Measure.TON_EYE&apos;).lowerCase().map({
  &apos;l&apos;:&apos;L&apos;,
  &apos;r&apos;:&apos;R&apos;,
  &apos;right&apos;:&apos;R&apos;,
  &apos;left&apos;:&apos;L&apos;,
  &apos;left eye&apos;:&apos;L&apos;,
  &apos;right eye&apos;:&apos;R&apos;,
  &apos;righr&apos;:&apos;R&apos;,
  &apos;rigth&apos;:&apos;R&apos;,
  &apos;rught&apos;:&apos;R&apos;,
  &apos;lrft&apos;:&apos;L&apos;,
  &apos;0&apos;:&apos;L&apos;,
  &apos;1&apos;:&apos;R&apos;,
  &apos;ll&apos;:&apos;L&apos;,
  &apos;rr&apos;:&apos;R&apos;,
  &apos;le&apos;:&apos;L&apos;,
  &apos;leeft&apos;:&apos;L&apos;,
  &apos;gauche&apos;:&apos;L&apos;,
  &apos;droit&apos;:&apos;R&apos;,
  &apos;droite&apos;:&apos;R&apos;},null)

// bare minimum useful data is IOPcc: Corneal Compensated Intraocular Pressure
var iopcc=$(&apos;clsa-dcs-f2.Tonometer:Measure.TON_IOPCC&apos;).asSequence() 

// if there is raw applanation and pressure data there will be a quality index
// for each set of measurements
var qual=$(&apos;clsa-dcs-f2.Tonometer:Measure.TON_QUALITYINDEX&apos;).asSequence()
var appl=$(&apos;clsa-dcs-f2.Tonometer:Measure.TON_PRESSURE&apos;).asSequence()
var pres=$(&apos;clsa-dcs-f2.Tonometer:Measure.TON_APPLANATION&apos;).asSequence()

var has_iopcc=iopcc.size().eq(eye.size()).value()
var has_qual=qual.size().eq(eye.size()).value()
var has_appl=appl.size().eq(eye.size()).value()
var has_pres=pres.size().eq(eye.size()).value()
var res=null
if(eye.isNull().not().value()) {
  var side={L:{left_iopcc:&apos;0&apos;,left_qi:&apos;-1&apos;,left_appl:&apos;0&apos;,left_pres:&apos;0&apos;},
            R:{right_iopcc:&apos;0&apos;,right_qi:&apos;-1&apos;,right_appl:&apos;0&apos;,right_pres:&apos;0&apos;}}
  for(var i=0;i&lt;eye.size();i++) {
    var e=eye.valueAt(i).value()
    if(has_iopcc) {
      var q=newValue(iopcc.valueAt(i).value(),&apos;text&apos;)
      if(q.matches(/^(\d*\.)?\d+$/)) {
        if(&apos;L&apos;==e) {
          side[e].left_iopcc=&apos;1&apos;
        } else if(&apos;R&apos;==e) {
          side[e].right_iopcc=&apos;1&apos;
        }
      }
    }
    if(has_qual) {
      var q=newValue(qual.valueAt(i).round(2).value(),&apos;text&apos;)
      if(q.matches(/^(\d*\.)?\d+$/)) {
        if(&apos;L&apos;==e) {
          side[e].left_qi=q.value()
        } else if(&apos;R&apos;==e) {
          side[e].right_qi=q.value()
        }
      }
    }
    if(has_appl) {
      var q=appl.valueAt(i).value().split(&apos;,&apos;).length
      if(&apos;L&apos;==e) {
        side[e].left_appl=q
      } else if(&apos;R&apos;==e) {
        side[e].right_appl=q
      }      
    }        
    if(has_pres) {
      var q=pres.valueAt(i).value().split(&apos;,&apos;).length
      if(&apos;L&apos;==e) {
        side[e].left_pres=q
      } else if(&apos;R&apos;==e) {
        side[e].right_pres=q
      }
    }
  }
  res=newValue(
    JSON.stringify(side.L).replace(/&quot;/g,&apos;&apos;).replace(/}/g,&apos;,&apos;) +
    JSON.stringify(side.R).replace(/&quot;/g,&apos;&apos;).replace(/{/g,&apos;&apos;), &apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_weight" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.Weight:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;Weight&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_weight" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Weight&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_weight" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;Weight&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;Weight&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_weight" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;Weight&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_weight&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_weight" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var w=$(&apos;clsa-dcs-f2.Weight:Measure.RES_WEIGHT_MEASURE&apos;)
var res=null
if(w.size().gt(1).value()){
  res=newValue(&apos;{stddev:&apos;+w.stddev().round(6).value()+&apos;,size:&apos;+w.size().value()+&apos;}&apos;,&apos;text&apos;)
} else if(w.size().eq(1).value()) {
  res=newValue(&apos;{stddev:0,size:1}&apos;,&apos;text&apos;)
} 
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_retinal_scan_left" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.RetinalScanLeft:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanLeft&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_retinal_scan_left" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;RetinalScanLeft&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_retinal_scan_left" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanLeft&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanLeft&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_retinal_scan_left" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;RetinalScanLeft&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_retinal_scan_left&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_retinal_scan_left" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var e=$(&apos;clsa-dcs-images-f2.RetinalScanLeft:EYE&apos;)
var res=null
if(e.isNull().not().value()) {
  res=newValue(&apos;{filesize:&apos;+e.length()+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_retinal_scan_right" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.RetinalScanRight:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanRight&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_retinal_scan_right" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;RetinalScanRight&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_retinal_scan_right" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanRight&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;RetinalScanRight&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_retinal_scan_right" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;RetinalScanRight&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_retinal_scan_right&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_retinal_scan_right" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var e=$(&apos;clsa-dcs-images-f2.RetinalScanRight:EYE&apos;)
var res=null
if(e.isNull().not().value()) {
  res=newValue(&apos;{filesize:&apos;+e.length()+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_lateral_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.LateralBoneDensity:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;LateralBoneDensity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_lateral_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;LateralBoneDensity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_lateral_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;LateralBoneDensity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;LateralBoneDensity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_lateral_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;LateralBoneDensity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_lateral_bone_density&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_lateral_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=$(&apos;clsa-dcs-images-f2.LateralBoneDensity:RES_SEL_DICOM_MEASURE&apos;)
if(res.isNull().not().value()) {
  res = newValue(&apos;{filesize:&apos;+res.length()+&apos;}&apos;,&apos;text&apos;)
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_standing_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.StandingHeight:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;StandingHeight&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_standing_height" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StandingHeight&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_standing_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;StandingHeight&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;StandingHeight&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_standing_height" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StandingHeight&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_standing_height&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_standing_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var w=$(&apos;clsa-dcs-f2.StandingHeight:Measure.RES_HEIGHT_MEASURE&apos;)
var res=null
if(w.size().gt(1).value()){
  res=newValue(&apos;{stddev:&apos;+w.stddev().round(6).value()+&apos;,size:&apos;+w.size().value()+&apos;}&apos;,&apos;text&apos;)
} else if(w.size().eq(1).value()) {
  res=newValue(&apos;{stddev:0,size:1}&apos;,&apos;text&apos;)
} 
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_spine_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.SpineBoneDensity:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;SpineBoneDensity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_spine_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;SpineBoneDensity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_spine_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;SpineBoneDensity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;SpineBoneDensity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_spine_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;SpineBoneDensity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_spine_bone_density&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_spine_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=$(&apos;clsa-dcs-images-f2.SpineBoneDensity:RES_SP_DICOM&apos;)
if(res.isNull().not().value()) {
  res = newValue(&apos;{filesize:&apos;+res.length()+&apos;}&apos;,&apos;text&apos;)
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_forearm_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.ForearmBoneDensity:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;ForearmBoneDensity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_forearm_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ForearmBoneDensity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_forearm_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;ForearmBoneDensity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;ForearmBoneDensity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_forearm_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ForearmBoneDensity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_forearm_bone_density&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_forearm_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var l=$group(&apos;OUTPUT_FA_SIDE&apos;,&apos;LEFT&apos;,&apos;RES_FA_DICOM&apos;).asSequence().last()
var r=$group(&apos;OUTPUT_FA_SIDE&apos;,&apos;RIGHT&apos;,&apos;RES_FA_DICOM&apos;).asSequence().last()
var res=null
if(l.isNull().not().value()) {
  res=newValue(&apos;{filesize:&apos;+ l.length().value() + &apos;}&apos;, &apos;text&apos;)
} else if(r.isNull().not().value()) {
  res=newValue(&apos;{filesize:&apos;+ r.length().value() + &apos;}&apos;, &apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_whole_body_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.WholeBodyBoneDensity:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;WholeBodyBoneDensity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_whole_body_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;WholeBodyBoneDensity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_whole_body_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;WholeBodyBoneDensity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;WholeBodyBoneDensity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_whole_body_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;WholeBodyBoneDensity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_whole_body_bone_density&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_whole_body_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var res=$(&apos;clsa-dcs-images-f2.WholeBodyBoneDensity:RES_WB_DICOM_1&apos;)
if(res.isNull().not().value()) {
  res = newValue(&apos;{filesize:&apos;+res.length()+&apos;}&apos;,&apos;text&apos;)
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_dual_hip_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.DualHipBoneDensity:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;DualHipBoneDensity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_dual_hip_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;DualHipBoneDensity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_dual_hip_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;DualHipBoneDensity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;DualHipBoneDensity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_dual_hip_bone_density" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;DualHipBoneDensity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_dual_hip_bone_density&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_dual_hip_bone_density" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var l=$group(&apos;Measure.OUTPUT_HIP_SIDE&apos;,&apos;LEFT&apos;,&apos;Measure.RES_HIP_DICOM&apos;).asSequence().last()
var r=$group(&apos;Measure.OUTPUT_HIP_SIDE&apos;,&apos;RIGHT&apos;,&apos;Measure.RES_HIP_DICOM&apos;).asSequence().last()
var res=null
if(!l.isNull().and(r.isNull()).value()) {
  res=newValue(
    &apos;{filesize_left:&apos;+
    (l.isNull().value()?&apos;0&apos;:l.length().value())+
    &apos;,filesize_right:&apos;+
    (r.isNull().value()?&apos;0&apos;:r.length().value())+
    &apos;}&apos;, &apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_carotid_intima" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-images-f2.CarotidIntima:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;CarotidIntima&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_carotid_intima" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;CarotidIntima&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_carotid_intima" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;CarotidIntima&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;CarotidIntima&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_carotid_intima" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;CarotidIntima&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_carotid_intima&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_carotid_intima" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var rc=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Right&apos;,&apos;Measure.CINELOOP_1&apos;).asSequence().last()
var rsr=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Right&apos;,&apos;Measure.SR_1&apos;).asSequence().last()
var rs1=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Right&apos;,&apos;Measure.STILL_IMAGE_1&apos;).asSequence().last()
var rs2=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Right&apos;,&apos;Measure.STILL_IMAGE_2&apos;).asSequence().last()
var rs3=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Right&apos;,&apos;Measure.STILL_IMAGE_3&apos;).asSequence().last()
var lc=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Left&apos;,&apos;Measure.CINELOOP_1&apos;).asSequence().last()
var lsr=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Left&apos;,&apos;Measure.SR_1&apos;).asSequence().last()
var ls1=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Left&apos;,&apos;Measure.STILL_IMAGE_1&apos;).asSequence().last()
var ls2=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Left&apos;,&apos;Measure.STILL_IMAGE_2&apos;).asSequence().last()
var ls3=$group(&apos;clsa-dcs-images-f2.CarotidIntima:Measure.SIDE&apos;,&apos;Left&apos;,&apos;Measure.STILL_IMAGE_3&apos;).asSequence().last()
var res=null
if(!rc.isNull().and(rsr.isNull(),rs1.isNull(),rs2.isNull(),rs3.isNull(),
   lc.isNull(),lsr.isNull(),ls1.isNull(),ls2.isNull(),ls3.isNull()).value()) {
  var str=&apos;{filesize_left_cine:&apos;+(lc.isNull().value()?&apos;0&apos;:lc.length().value())+&apos;,&apos;
  str+=&apos;filesize_left_sr:&apos;+(lsr.isNull().value()?&apos;0&apos;:lsr.length().value())+&apos;,&apos;
  str+=&apos;filesize_left_still_1:&apos;+(ls1.isNull().value()?&apos;0&apos;:ls1.length().value())+&apos;,&apos;
  str+=&apos;filesize_left_still_2:&apos;+(ls2.isNull().value()?&apos;0&apos;:ls2.length().value())+&apos;,&apos;
  str+=&apos;filesize_left_still_3:&apos;+(ls3.isNull().value()?&apos;0&apos;:ls3.length().value())+&apos;,&apos;
  str+=&apos;filesize_right_cine:&apos;+(rc.isNull().value()?&apos;0&apos;:rc.length().value())+&apos;,&apos;
  str+=&apos;filesize_right_sr:&apos;+(rsr.isNull().value()?&apos;0&apos;:rsr.length().value())+&apos;,&apos;
  str+=&apos;filesize_right_still_1:&apos;+(rs1.isNull().value()?&apos;0&apos;:rs1.length().value())+&apos;,&apos;
  str+=&apos;filesize_right_still_2:&apos;+(rs2.isNull().value()?&apos;0&apos;:rs2.length().value())+&apos;,&apos;
  str+=&apos;filesize_right_still_3:&apos;+(rs3.isNull().value()?&apos;0&apos;:rs3.length().value())+&apos;}&apos;
  res=newValue(str,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_tug" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.TUG:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;TUG&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_tug" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;TUG&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_tug" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;TUG&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;TUG&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_tug" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;TUG&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_tug&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_tug" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var tt=$(&apos;clsa-dcs-f2.TUG:TUG_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.TUG:TUG_TIME_2&apos;))
var res=null
if(tt.isNull().not().value()) {
  var wt=$(&apos;clsa-dcs-f2.4mWalk:WLK_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.4mWalk:WLK_TIME_2&apos;))  
  var ct=$(&apos;clsa-dcs-f2.ChairRise:CR_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.ChairRise:CR_TIME_2&apos;))
  var str = &apos;0&apos;
  if(tt.isNull().not().and(ct.isNull().not()).value()) {
    var cv=ct.div($(&apos;clsa-dcs-f2.ChairRise:CR_NB&apos;).whenNull(1))
    str=Math.round(tt.minus(wt.multiply(1.5).plus(cv)).abs().value(),0)
  } 
  res=newValue(
    &apos;{time:&apos;+tt.round(3).value()+
    &apos;,congruency:&apos;+str+
    &apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_chair_rise" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.ChairRise:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;ChairRise&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_chair_rise" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ChairRise&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_chair_rise" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;ChairRise&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;ChairRise&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_chair_rise" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;ChairRise&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_chair_rise&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_chair_rise" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var ct=$(&apos;clsa-dcs-f2.ChairRise:CR_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.ChairRise:CR_TIME_2&apos;))  
var res=null
if(ct.isNull().not().value()) {
  var wt=$(&apos;clsa-dcs-f2.4mWalk:WLK_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.4mWalk:WLK_TIME_2&apos;))  
  var tt=$(&apos;clsa-dcs-f2.TUG:TUG_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.TUG:TUG_TIME_2&apos;))
  var str = &apos;0&apos;
  if(tt.isNull().not().and(ct.isNull().not()).value()) {
    var cv=ct.div($(&apos;clsa-dcs-f2.ChairRise:CR_NB&apos;).whenNull(1))
    str=Math.round(tt.minus(wt.multiply(1.5).plus(cv)).abs().value(),0)
  }  
  res=newValue(
    &apos;{time:&apos;+ct.round(3).value()+
    &apos;,congruency:&apos;+str+
    &apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_hips_waist" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.HipsWaist:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;HipsWaist&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_hips_waist" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;HipsWaist&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_hips_waist" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;HipsWaist&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;HipsWaist&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_hips_waist" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;HipsWaist&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_hips_waist&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_hips_waist" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var i=$(&apos;clsa-dcs-f2.HipsWaist:IV_MEASURE_TAKEN&apos;)
var w=$(&apos;clsa-dcs-f2.HipsWaist:RES_WAIST_SIZE&apos;)
var h=$(&apos;clsa-dcs-f2.HipsWaist:RES_HIPS_SIZE&apos;)
var r=$(&apos;clsa-dcs-f2.HipsWaist:CALC_WAIST_TO_HIP_RATIO&apos;)
var res=null
if(!i.isNull().and(w.isNull(),h.isNull(),r.isNull()).value()) {
  var str=&apos;{iv_type:&apos;+(i.isNull().value()?&apos;NA&apos;:i.value())+&apos;,&apos;
  str+=&apos;size_waist:&apos;+(w.isNull().value()?&apos;0&apos;:w.value())+&apos;,&apos;
  str+=&apos;size_hips:&apos;+(h.isNull().value()?&apos;0&apos;:h.value())+&apos;,&apos;
  str+=&apos;ratio:&apos;+(r.isNull().value()?&apos;0&apos;:r.round(3).value())+&apos;}&apos;
  res=newValue(str,&apos;text&apos;)
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_standing_balance" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.StandingBalance:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;StandingBalance&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_standing_balance" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StandingBalance&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_standing_balance" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;StandingBalance&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;StandingBalance&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()
  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
  if(null===res) {
    var l1=$(&apos;clsa-dcs-f2.StandingBalance:STAND_COMPLETION_LEFT&apos;)  
    var r1=$(&apos;clsa-dcs-f2.StandingBalance:STAND_COMPLETION_RIGHT&apos;)  
    if(l1.any(&apos;NO&apos;).value()) {
      var l2=$(&apos;clsa-dcs-f2.StandingBalance:STAND_UNCOMPLETE_LEFT&apos;).map({
        &apos;TECHNICAL&apos;:&apos;TechnicalProblem&apos;,
        &apos;PARTICIPANT-DECISION&apos;:&apos;ParticipantDecision&apos;,
        &apos;INTERVIEWER-DECISION&apos;:&apos;InterviewerDecision&apos;,
        &apos;OTHER-SPEFICY&apos;:&apos;SeeComment&apos;},null)
      if(l2.isNull().not().value()) {
        res=l2
      }  
    } 
    if (null===res &amp;&amp; r1.any(&apos;NO&apos;).value()) {
      var r2=$(&apos;clsa-dcs-f2.StandingBalance:STAND_UNCOMPLETE_RIGHT&apos;).map({
        &apos;TECHNICAL&apos;:&apos;TechnicalProblem&apos;,
        &apos;PARTICIPANT-DECISION&apos;:&apos;ParticipantDecision&apos;,
        &apos;INTERVIEWER-DECISION&apos;:&apos;InterviewerDecision&apos;,
        &apos;OTHER-SPEFICY&apos;:&apos;SeeComment&apos;},null)
      if(r2.isNull().not().value()) {
        res=r2
      }
    }
  }
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_standing_balance" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StandingBalance&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_standing_balance&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_standing_balance" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var b=$(&apos;clsa-dcs-f2.StandingBalance:STAND_BEST&apos;).whenNull($(&apos;clsa-dcs-f2.StandingBalance:STAND_BEST_2&apos;))
var lc =$(&apos;clsa-dcs-f2.StandingBalance:STAND_COMPLETION_LEFT&apos;)
var rc =$(&apos;clsa-dcs-f2.StandingBalance:STAND_COMPLETION_RIGHT&apos;)
var res=null
if(!b.isNull().and(lc.isNull(),rc.isNull()).value()) {
  var str = &apos;{time_best:&apos;
  if(b.isNull().not().value()) {
    str+=b.round(3).value()
  } else  {
    str+=&apos;-1&apos;
  }
  var l=$(&apos;clsa-dcs-f2.StandingBalance:STAND_LEFT_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.StandingBalance:STAND_LEFT_TIME_2&apos;))
  str+=&apos;,time_left:&apos;
  if(l.isNull().not().value()) {
    str+=l.round(3).value()
  } else  {
    str+=&apos;-1&apos;
  }
  var r=$(&apos;clsa-dcs-f2.StandingBalance:STAND_RIGHT_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.StandingBalance:STAND_RIGHT_TIME_2&apos;))
  str+=&apos;,time_right:&apos;
  if(r.isNull().not().value()) {
    str+=r.round(3).value()
  } else  {
    str+=&apos;-1&apos;
  }
  str+=&apos;}&apos;  
  res=newValue(str,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_four_metre_walk" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.4mWalk:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;4mWalk&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_four_metre_walk" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;4mWalk&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_four_metre_walk" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;4mWalk&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;4mWalk&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_four_metre_walk" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;4mWalk&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_four_metre_walk&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_four_metre_walk" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var wt=$(&apos;clsa-dcs-f2.4mWalk:WLK_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.4mWalk:WLK_TIME_2&apos;))
var res=null
if(wt.isNull().not().value()) {
  var tt=$(&apos;clsa-dcs-f2.TUG:TUG_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.TUG:TUG_TIME_2&apos;))
  var ct=$(&apos;clsa-dcs-f2.ChairRise:CR_TIME&apos;).whenNull($(&apos;clsa-dcs-f2.ChairRise:CR_TIME_2&apos;))
  var str = &apos;0&apos;
  if(tt.isNull().not().and(ct.isNull().not()).value()) {
    var cv=ct.div($(&apos;clsa-dcs-f2.ChairRise:CR_NB&apos;).whenNull(1))
    str=Math.round(tt.minus(wt.multiply(1.5).plus(cv)).abs().value(),0)
  }
  res=newValue(
    &apos;{time:&apos;+wt.round(3).value()+
    &apos;,congruency:&apos;+str+
    &apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_sitting_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.SittingHeight:InstrumentRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;SittingHeight&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_sitting_height" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;SittingHeight&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_sitting_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;SittingHeight&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;SittingHeight&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()
  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_sitting_height" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;SittingHeight&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_sitting_height&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_sitting_height" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var w=$(&apos;clsa-dcs-f2.SittingHeight:Measure.RES_SIT_HEIGHT_MEASURE&apos;)
var res=null
if(w.size().gt(1).value()){
  res=newValue(&apos;{stddev:&apos;+w.stddev().round(6).value()+&apos;,size:&apos;+w.size().value()+&apos;}&apos;,&apos;text&apos;)
} else if(w.size().eq(1).value()) {
  res=newValue(&apos;{stddev:0,size:1}&apos;,&apos;text&apos;)
} 
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_vision_acuity" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.VisionAcuity:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;VisionAcuity&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_vision_acuity" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;VisionAcuity&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_vision_acuity" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().and(
   $(&apos;clsa-dcs-f2.Participants:DCSatHOME&apos;).isNull()).not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;VisionAcuity&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;VisionAcuity&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()
  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
  if(null===res) {
    var tests=[&apos;DONE_VA&apos;,&apos;DONE_BOTH_VA&apos;,&apos;DONE_LEFT_VA&apos;,&apos;DONE_RIGHT_VA&apos;,&apos;DONE_LEFT_PO_VA&apos;,&apos;DONE_RIGHT_PO_VA&apos;]
    var reasons=[&apos;DONE_RSN_VA&apos;,&apos;DONE_RSN_BOTH_VA&apos;,&apos;DONE_RSN_LEFT_VA&apos;,&apos;DONE_RSN_RIGHT_VA&apos;,&apos;DONE_RSN_LEFT_PO_VA&apos;,&apos;DONE_RSN_RIGHT_PO_VA&apos;]
    for(var i=0;i&lt;tests.length;i++) {
      var t=$(&apos;clsa-dcs-f2.VisionAcuity:&apos;+tests[i])
      if(t.any(&apos;NO&apos;).value()) {
        var r=$(&apos;clsa-dcs-f2.VisionAcuity:&apos;+reasons[i]).map({
        &apos;TECHNICAL-PROBLEM&apos;:&apos;TechnicalProblem&apos;,
        &apos;PARTICIPANT-DECISION&apos;:&apos;ParticipantDecision&apos;,
        &apos;INTERVIEWER-DECISION&apos;:&apos;InterviewerDecision&apos;,
        &apos;OTHER&apos;:&apos;SeeComment&apos;},null)
        if(r.isNull().not().value()) {
          res=r
          break
        }
      }
    }
  }
}  
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_vision_acuity" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;VisionAcuity&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_vision_acuity&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_vision_acuity" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var count = {RIGHT:0,LEFT:0}
var rtests=[&apos;DONE_RIGHT_VA&apos;,&apos;DONE_RIGHT_PO_VA&apos;]
var ltests=[&apos;DONE_LEFT_VA&apos;,&apos;DONE_LEFT_PO_VA&apos;]
var n=0
for(var i=0;i&lt;rtests.length;i++) {
  var t=$(&apos;clsa-dcs-f2.VisionAcuity:&apos;+rtests[i])
  if(t.isNull().value()) n++
  if(t.any(&apos;YES&apos;).value()) {
    count[&apos;RIGHT&apos;]++
  }
  t=$(&apos;clsa-dcs-f2.VisionAcuity:&apos;+ltests[i])
  if(t.isNull().value()) n++
  if(t.any(&apos;YES&apos;).value()) {
    count[&apos;LEFT&apos;]++
  }
}
var res=null
if(4!=n) {
  res=newValue(
    &apos;{left_test:&apos;+count[&apos;LEFT&apos;]+
    &apos;,right_test:&apos;+count[&apos;RIGHT&apos;]+
    &apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_stroop_fas" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-dcs-f2.StroopFAS:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;StroopFAS&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_stroop_fas" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StroopFAS&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_stroop_fas" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">// if a dcs by phone visit, then the skip will be &quot;ModifiedVisit&quot;
var res=null
if($(&apos;clsa-dcs-f2.Participants:DCS_PHONE&apos;).isNull().not().value()){
  res=newValue(&apos;ModifiedVisit&apos;,&apos;text&apos;)
} else {
  var v1=$group(&apos;Admin.Action.stage&apos;,&apos;StroopFAS&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
  var v2=$group(&apos;Admin.Action.stage&apos;,&apos;StroopFAS&apos;,&apos;Admin.Action.eventReason&apos;).asSequence()

  var arr=[]  // string array of events
  for(var i=0; i&lt;v1.size(); i++) {
    if(v1.valueAt(i).any(&apos;SKIP&apos;).not().value() ||
       v2.valueAt(i).isNull().value()) continue
    var key=v2.valueAt(i).value().slice(14)
    if(-1==arr.indexOf(key))
      arr.push(key)
  }
  if(undefined!==arr &amp;&amp; 0&lt;arr.length) {
    res=newValue(arr.pop(),&apos;text&apos;)  
  }
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_stroop_fas" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var stage=newValue($group(&apos;clsa-dcs-f2.Participants:Admin.StageInstance.stage&apos;,&apos;StroopFAS&apos;,&apos;Admin.StageInstance.lastState&apos;).asSequence().last(),&apos;text&apos;)
$this(&apos;data_qac_stroop_fas&apos;).isNull().and(stage.any(&apos;Skipped&apos;,&apos;NotApplicable&apos;).not()).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_stroop_fas" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var d=$(&apos;clsa-dcs-f2.StroopFAS:STP_DOTREC_COF2&apos;)
var w=$(&apos;clsa-dcs-f2.StroopFAS:STP_WORREC_COF2&apos;)
var c=$(&apos;clsa-dcs-f2.StroopFAS:STP_COLREC_COF2&apos;)
var f=$(&apos;clsa-dcs-f2.StroopFAS:FAS_FREC_COF2&apos;)
var a=$(&apos;clsa-dcs-f2.StroopFAS:FAS_AREC_COF2&apos;)
var s=$(&apos;clsa-dcs-f2.StroopFAS:FAS_SREC_COF2&apos;)
var res=null
if(!d.isNull().and(w.isNull(),c.isNull(),f.isNull(),a.isNull(),s.isNull()).value()) {
  var str=&apos;{filesize_dot:&apos;+(d.isNull().value()?&apos;0&apos;:d.length().value())+&apos;,&apos;
  str+=&apos;filesize_wor:&apos;+(w.isNull().value()?&apos;0&apos;:w.length().value())+&apos;,&apos;
  str+=&apos;filesize_col:&apos;+(c.isNull().value()?&apos;0&apos;:c.length().value())+&apos;,&apos;
  str+=&apos;filesize_f:&apos;+(f.isNull().value()?&apos;0&apos;:f.length().value())+&apos;,&apos;
  str+=&apos;filesize_a:&apos;+(a.isNull().value()?&apos;0&apos;:a.length().value())+&apos;,&apos;
  str+=&apos;filesize_s:&apos;+(s.isNull().value()?&apos;0&apos;:s.length().value())+&apos;}&apos;
  res=newValue(str,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
    </variables>
  </variables>
  <created valueType="datetime">2018-05-15T13:40:50.956-04</created>
  <updated valueType="datetime">2018-06-20T13:28:28.332-04</updated>
</org.obiba.magma.views.View>