<org.obiba.magma.views.View>
  <name>QC_BL_IH</name>
  <from class="org.obiba.magma.views.JoinTable">
    <list>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.Participants</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.InHome_1</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.InHome_2</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.InHome_3</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.InHome_Id</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.ConclusionQuestionnaire</reference>
      </table>
      <table inner="false" class="org.obiba.magma.support.ValueTableReference">
        <reference>clsa-inhome.Consent</reference>
      </table>
    </list>
  </from>
  <select class="org.obiba.magma.views.support.NoneClause"/>
  <where class="org.obiba.magma.views.support.AllClause"/>
  <variables class="org.obiba.magma.js.views.VariablesClause">
    <variables class="linked-hash-set">
      <variable name="stage_technician_inhome_1" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-inhome.InHome_1:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;InHome_1&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_1" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;InHome_1&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_1" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_1&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_1&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_1" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var p=$(&apos;clsa-inhome.InHome_1:QuestionnaireMetric.missingCount&apos;).asSequence()
var q=$(&apos;clsa-inhome.InHome_1:QuestionnaireMetric.questionCount&apos;).asSequence()
var res=null
if(p.isNull().and(q.isNull()).not().value() &amp;&amp; 0!=q.sum()){
  res=newValue(
    &apos;{complete:&apos;+
    Math.round(q.sum().minus(p.sum()).multiply(100).div(q.sum()).value())
    +&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_1" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_1&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_1&apos;).eq(0),
  $this(&apos;stage_skip_inhome_1&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_inhome_2" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-inhome.InHome_2:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;InHome_2&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_2" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;InHome_2&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_2" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_2&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_2&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_2" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var p=$(&apos;clsa-inhome.InHome_2:QuestionnaireMetric.missingCount&apos;).asSequence()
var q=$(&apos;clsa-inhome.InHome_2:QuestionnaireMetric.questionCount&apos;).asSequence()
var res=null
if(p.isNull().and(q.isNull()).not().value() &amp;&amp; 0!=q.sum()){
  res=newValue(
    &apos;{complete:&apos;+
    Math.round(q.sum().minus(p.sum()).multiply(100).div(q.sum()).value())
    +&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_2" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_2&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_2&apos;).eq(0),
  $this(&apos;stage_skip_inhome_2&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_inhome_3" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-inhome.InHome_3:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;InHome_3&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_3" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;InHome_3&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_3" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_3&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_3&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_3" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var p=$(&apos;clsa-inhome.InHome_3:QuestionnaireMetric.missingCount&apos;).asSequence()
var q=$(&apos;clsa-inhome.InHome_3:QuestionnaireMetric.questionCount&apos;).asSequence()
var res=null
if(p.isNull().and(q.isNull()).not().value() &amp;&amp; 0!=q.sum()){
  res=newValue(
    &apos;{complete:&apos;+
    Math.round(q.sum().minus(p.sum()).multiply(100).div(q.sum()).value())
    +&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_3" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_3&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_3&apos;).eq(0),
  $this(&apos;stage_skip_inhome_3&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_inhome_id" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-inhome.InHome_Id:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;InHome_Id&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_id" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;InHome_Id&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_id" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_Id&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;InHome_Id&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_id" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var p=$(&apos;clsa-inhome.InHome_Id:QuestionnaireMetric.missingCount&apos;).asSequence()
var q=$(&apos;clsa-inhome.InHome_Id:QuestionnaireMetric.questionCount&apos;).asSequence()
var res=null
if(p.isNull().and(q.isNull()).not().value() &amp;&amp; 0!=q.sum()){
  res=newValue(
    &apos;{complete:&apos;+
    Math.round(q.sum().minus(p.sum()).multiply(100).div(q.sum()).value())
    +&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_id" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_id&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_id&apos;).eq(0),
  $this(&apos;stage_skip_inhome_id&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="interview_site" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;Admin.ApplicationConfiguration.siteName&apos;).map({
  &apos;BritishColumbia&apos;:&apos;University of BC DCS&apos;,
  &apos;British Columbia&apos;:&apos;University of BC DCS&apos;,
  &apos;Calgary&apos;:&apos;Calgary DCS&apos;,
  &apos;Dalhousie&apos;:&apos;Dalhousie DCS&apos;,
  &apos;Hamilton&apos;:&apos;Hamilton DCS&apos;,
  &apos;Manitoba&apos;:&apos;Manitoba DCS&apos;,
  &apos;McGill&apos;:&apos;McGill DCS&apos;,
  &apos;McMaster&apos;:&apos;Hamilton DCS&apos;,
  &apos;Memorial&apos;:&apos;Memorial DCS&apos;,
  &apos;Memorial University&apos;:&apos;Memorial DCS&apos;,
  &apos;Ottawa&apos;:&apos;Ottawa DCS&apos;,
  &apos;Sherbrooke&apos;:&apos;Sherbrooke DCS&apos;,
  &apos;Simon Fraser&apos;:&apos;Simon Fraser DCS&apos;,
  &apos;SimonFraser&apos;:&apos;Simon Fraser DCS&apos;,
  &apos;UniversityofBC&apos;:&apos;University of BC DCS&apos;,
  &apos;University of Manitoba&apos;:&apos;Manitoba DCS&apos;,
  &apos;University of Victoria&apos;:&apos;Victoria DCS&apos;,
  &apos;Victoria&apos;:&apos;Victoria DCS&apos;},null)</attribute>
        </attributes>
      </variable>
      <variable name="interview_start_date" valueType="date" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;Admin.Interview.startDate&apos;)</attribute>
        </attributes>
      </variable>
      <variable name="interview_barcode" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;Admin.Participant.barcode&apos;)</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_inhome_conclusion_questionnaire" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$(&apos;clsa-inhome.ConclusionQuestionnaire:QuestionnaireRun.user&apos;).whenNull(
  $group(&apos;Admin.Action.stage&apos;,&apos;ConclusionQuestionnaire&apos;,&apos;Admin.Action.user&apos;).asSequence().last()).lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_conclusion_questionnaire" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;ConclusionQuestionnaire&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;ConclusionQuestionnaire&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_conclusion_questionnaire" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_conclusion_questionnaire&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_conclusion_questionnaire&apos;).eq(0),
  $this(&apos;stage_skip_inhome_conclusion_questionnaire&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_conclusion_questionnaire" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;ConclusionQuestionnaire&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_conclusion_questionnaire" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var p=$(&apos;clsa-inhome.ConclusionQuestionnaire:CHECKLIST.DCS_VISIT_INFO&apos;).lowerCase()
var q=$(&apos;clsa-inhome.ConclusionQuestionnaire:CHECKLIST.PROXY_INFO_PACKAGE&apos;).lowerCase()
var res=null
if(p.isNull().or(q.isNull()).not().value()){
  var a=p.any(&apos;yes&apos;).value()
  var b=q.any(&apos;yes&apos;).value()
  var n=0 
  if(a) n++
  if(b) n++
  res=newValue(&apos;{checklist:&apos;+n+&apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="data_qac_inhome_consent" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var m=$(&apos;clsa-inhome.Consent:mode&apos;)
var a=$(&apos;clsa-inhome.Consent:accepted&apos;)
var res=null
if(m.isNull().and(a.isNull()).not().value()) {
  res=newValue(
    &apos;{mode:&apos;+m.lowerCase().value()+
    &apos;,accepted:&apos;+(a.value()?1:0)+
    &apos;}&apos;,&apos;text&apos;)
}
res</attribute>
        </attributes>
      </variable>
      <variable name="stage_technician_inhome_consent" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;Admin.Action.stage&apos;,&apos;Consent&apos;,&apos;Admin.Action.user&apos;).asSequence().last().lowerCase()</attribute>
        </attributes>
      </variable>
      <variable name="stage_contraindicated_inhome_consent" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$group(&apos;clsa-inhome.Participants:Admin.StageInstance.stage&apos;,&apos;Consent&apos;,
&apos;Admin.StageInstance.lastState&apos;).any(&apos;Contraindicated&apos;,&apos;NotApplicable&apos;).value() 
? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="data_missing_inhome_consent" valueType="integer" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">$this(&apos;data_qac_inhome_consent&apos;).isNull().and(
  $this(&apos;stage_contraindicated_inhome_consent&apos;).eq(0),
  $this(&apos;stage_skip_inhome_consent&apos;).isNull()
).value() ? 1 : 0</attribute>
        </attributes>
      </variable>
      <variable name="stage_skip_inhome_consent" valueType="text" entityType="Participant" unit="" mimeType="" referencedEntityType="" index="0">
        <attributes>
          <attribute name="script" valueType="text">var action=$group(&apos;Admin.Action.stage&apos;,&apos;Consent&apos;,&apos;Admin.Action.actionType&apos;).asSequence()
var res=$group(&apos;Admin.Action.stage&apos;,&apos;Consent&apos;,&apos;Admin.Action.eventReason&apos;).asSequence().filter(function(v,i){
  var j=action.indexOf(&apos;SKIP&apos;)
  return j==i
  }).last()
if(res.isNull().not().value()) {
  res=newValue(res.value().slice(14),&apos;text&apos;)  
}
res</attribute>
        </attributes>
      </variable>
    </variables>
  </variables>
  <created valueType="datetime">2018-08-13T13:56:44.296-04</created>
  <updated valueType="datetime">2018-09-26T15:36:59.304-04</updated>
</org.obiba.magma.views.View>