{"from": ["clsa-inhome-f3.Participants"],"name": "QC_F3_interview","datasourceName": "cosmos_inhome","Magma.VariableListViewDto.view": {"variables": [{"name": "barcode","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('Admin.Participant.barcode')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "site","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('Admin.ApplicationConfiguration.siteName').lowerCase().map({\n  'britishcolumbia':'University of BC DCS',\n  'british columbia':'University of BC DCS',\n  'calgary':'Calgary DCS',\n  'dalhousie':'Dalhousie DCS',\n  'hamilton':'Hamilton DCS',\n  'hamiltonhome1':'Hamilton DCS',\n  'himilton':'Hamilton DCS',\n  'manitoba':'Manitoba DCS',\n  'mcgill':'McGill DCS',\n  'mcmaster':'Hamilton DCS',\n  'memorial':'Memorial DCS',\n  'memorial university':'Memorial DCS',\n  'ottawa':'Ottawa DCS',\n  'sherbrooke':'Sherbrooke DCS',\n  'simon fraser':'Simon Fraser DCS',\n  'simonfraser':'Simon Fraser DCS',\n  'universityofbc':'University of BC DCS',\n  'university of manitoba':'Manitoba DCS',\n  'university of victoria':'Victoria DCS',\n  'victoria':'Victoria DCS'},null)"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "start_date","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('Admin.Interview.startDate').format('yyyy-MM-dd')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "duration","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "var t = $('clsa-inhome-f3.Participants:Admin.Action.dateTime').asSequence().trimmer()\nvar d = []\nfor(var i=0;i<t.size();i++) {\n  var dy = t.valueAt(i).format('yyyyMMdd')\n  if(undefined===d[dy]){\n    d[dy]=[t.valueAt(i)]\n  } else {\n    d[dy].push(t.valueAt(i))\n  }\n}\nvar res = newValue(0,'integer')\nfor(var dy in d) {\n  if(1<d[dy].length) {\n    var l = newSequence(d[dy],'datetime').sort()\n    res = res.plus(l.last().time().minus(l.first().time()).div(1000).whenNull(0))\n  }    \n}\nres.gt(0).value()?res:null"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "stage_duration","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "// estimate of stage_duration\n// accounts for stages that start and end on different dates by rejecting paired action datetimes\n//\nvar s = $('clsa-inhome-f3.Participants:Admin.Action.stage').filter(function(v,i){ return i==this.indexOf(v) }).trimmer()\nvar res = newValue(0,'integer')\nfor(var i=0;i<s.size();i++) {\n  var r = $group('Admin.Action.stage',s.valueAt(i).value(),'Admin.Action.dateTime').asSequence()\n  for(var k=0; k<r.size();k+=2) {      \n    if(r.valueAt(k+1).format('yyyyMMdd').eq(r.valueAt(k).format('yyyyMMdd')).value()) {\n      res = res.plus(r.valueAt(k+1).time().minus(r.valueAt(k).time()).div(1000).whenNull(0))\n    }\n  }  \n}\nres.gt(0).value()?res:null"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "type","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('clsa-inhome-f3.Participants:INHOME_PHONE').value() ? 'inhome phone' : 'inhome'"}],"unit": "","index": 0,"referencedEntityType": ""}]}}