{"from": ["clsa-dcs.Participants","clsa-dcs.ECG","clsa-dcs.4mWalk","clsa-dcs.Blood","clsa-dcs.Blood2","clsa-dcs.ChairRise","clsa-dcs.ConclusionQuestionnaire","clsa-dcs.ContraIndications","clsa-dcs.DiseaseSymptoms","clsa-dcs.EventPMT","clsa-dcs.FunctionalStatus","clsa-dcs.HearingQuestionnaire","clsa-dcs.NeuropsychologicalBattery","clsa-dcs.NeuropsychologicalBatteryScoring","clsa-dcs.QuestionnaireBoneDensity","clsa-dcs.StandingBalance","clsa-dcs.TUG","clsa-dcs.TimeBasedProspectiveMemoryTask","clsa-dcs.Urine","clsa-dcs.VisionAcuity","clsa-dcs.BloodPressure","clsa-dcs-images.CarotidIntima","clsa-dcs.CognitiveTest","clsa-dcs-images.DualHipBoneDensity","clsa-dcs-images.ForearmBoneDensity","clsa-dcs.GripStrength","clsa-dcs.Hearing","clsa-dcs.HipsWaist","clsa-dcs-images.LateralBoneDensity","clsa-dcs-images.RetinalScan","clsa-dcs.SittingHeight","clsa-dcs-images.Plaque","clsa-dcs.Spirometry","clsa-dcs.Phlebotomy","clsa-dcs.Tonometer","clsa-dcs.Weight","clsa-dcs-images.WholeBodyBoneDensity"],"name": "QC_BL_meta","datasourceName": "cosmos_dcs","Magma.VariableListViewDto.view": {"variables": [{"name": "group_questionnaire","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'4mWalk',\n'Blood',\n'Blood2',\n'ChairRise',\n'ConclusionQuestionnaire',\n'ContraIndications',\n'DiseaseSymptoms',\n'EventPMT',\n'FunctionalStatus',\n'HearingQuestionnaire',\n'NeuropsychologicalBattery',\n'NeuropsychologicalBatteryScoring',\n'Phlebotomy',\n'QuestionnaireBoneDensity',\n'StandingBalance',\n'TUG',\n'TimeBasedProspectiveMemoryTask',\n'Urine',\n'VisionAcuity'\n]\n$('clsa-dcs.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_instrument","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'BloodPressure',\n'CarotidIntima',\n'CognitiveTest',\n'DualHipBoneDensity',\n'ECG',\n'ForearmBoneDensity',\n'GripStrength',\n'Hearing',\n'HipsWaist',\n'LateralBoneDensity',\n'Plaque',\n'RetinalScan',\n'Spirometry',\n'SittingHeight',\n'StandingHeight',\n'Tonometer',\n'Weight',\n'WholeBodyBoneDensity'\n]\n\n$('clsa-dcs.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_duration_ecg","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "var res = null\nif($('clsa-dcs.ECG:RES_MEASUREMENT_DATE').isNull().not().and(\n   $('clsa-dcs.ECG:RES_MEASUREMENT_TIME').isNull().not()).value()) {\n  var ecg = newValue(\n    $('clsa-dcs.ECG:RES_MEASUREMENT_DATE').value() + ' ' +\n    $('clsa-dcs.ECG:RES_MEASUREMENT_TIME').value(), 'datetime')\n    \n  var ecgTime = ecg.time()\n  var preIndex = -1\n  var postIndex = -1    \n  var pre = newValue(null, 'datetime')\n  var post = newValue(null, 'datetime')\n  var minPre = 10000000000000000\n  var minPost = minPre  \n  var stages = $('clsa-dcs.Participants:Admin.StageInstance.stage').asSequence().filter(function(v) {\n    return v.matches(/ECG/).not().value()\n  }) \n  var times = {'pre':null,'post':null}\n\n  for(var i = 0; i < stages.size(); i++) {\n    var stage = stages.valueAt(i).value()    \n    \n    if(-1 != $this('group_questionnaire').indexOf(stage)) {\n      pre = $('clsa-dcs.'+stage+':QuestionnaireRun.timeEnd')      \n    } else if(-1 != $this('group_instrument').indexOf(stage)) {\n      pre = $('clsa-dcs.'+stage+':InstrumentRun.timeEnd')      \n    } else if(-1 != $this('group_other').indexOf(stage)) {\n      pre = $('clsa-dcs.'+stage+':timeEnd') \n    } else {\n      continue\n    }\n    if(ecg.after(pre).value()) {\n      var p = ecgTime.minus(pre.time()).value()\n      if(p < minPre) {\n        minPre = p\n        preIndex = i\n        times['pre'] = pre.time()\n      }        \n    } else {\n      if(-1 != $this('group_questionnaire').indexOf(stage)) {        \n        post = $('clsa-dcs.'+stage+':QuestionnaireRun.timeStart')\n      } else if(-1 != $this('group_instrument').indexOf(stage)) {        \n        post = $('clsa-dcs.'+stage+':InstrumentRun.timeStart')\n      } else if(-1 != $this('group_other').indexOf(stage)) {        \n        post = $('clsa-dcs.'+stage+':timeStart')\n      } else {\n        continue\n      }     \n      if (ecg.before(post).value()) {\n        var p = post.time().minus(ecgTime).value()\n        if(p < minPost) {\n          minPost = p\n          postIndex = i\n          times['post'] = post.time()\n        }\n      }\n    }\n  }\n  if(1<(postIndex-preIndex)) {\n    res = times['post'].minus(times['pre']).div(1000)    \n  }\n}\n\nif(null == res) {\n  var post = $('clsa-dcs.ECG:InstrumentRun.timeEnd')\n  var pre = $('clsa-dcs.ECG:InstrumentRun.timeStart')\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n  if(null == res) {\n    res = $group(\n      'clsa-dcs.Participants:Admin.StageInstance.stage',\n      'ECG',\n      'Admin.StageInstance.duration').asSequence().sum()\n  }\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_duration_dexa","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list = ['LateralBoneDensity','ForearmBoneDensity','WholeBodyBoneDensity','DualHipBoneDensity']\nvar stages = $('clsa-dcs.Participants:Admin.StageInstance.stage').asSequence().filter(function(v) {\n    return -1!=list.indexOf(v.value())\n  })\nvar res = null\nif(stages.empty().not().value()) {\n  // bracket the actual bone density acquisitions\n  // \n  var pre = $('clsa-dcs.QuestionnaireBoneDensity:QuestionnaireRun.timeEnd')\n  var post = $('clsa-dcs.EventPMT:QuestionnaireRun.timeStart')  \n  if(pre.before(post).value()) {    \n    res = post.time().minus(pre.time()).div(1000)\n  }  \n}\n\nif(null == res) {\n  res = newValue(0,'integer')\n  list.forEach(function(stage) {\n    var pre = $('clsa-dcs.'+stage+':InstrumentRun.timeEnd')\n    var post = $('clsa-dcs.'+stage+':InstrumentRun.timeStart')  \n    if(pre.before(post).value()) {    \n      res = res.plus(post.time().minus(pre.time()).div(1000))\n    }    \n  })\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_blood","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "var res = null\nvar u = $group('clsa-dcs.Participants:Admin.StageInstance.stage','Phlebotomy','Admin.StageInstance.lastState').asSequence().last()\nvar v = $group('clsa-dcs.Participants:Admin.StageInstance.stage','Blood','Admin.StageInstance.lastState').asSequence().last()\nvar w = $group('clsa-dcs.Participants:Admin.StageInstance.stage','Blood2','Admin.StageInstance.lastState').asSequence().last()\nvar p = $('clsa-dcs.Participants:Admin.StageInstance.stage').any('Phlebotomy').and(w.isNull().not()).value()\nvar q = $('clsa-dcs.Participants:Admin.StageInstance.stage').any('Blood').and(u.isNull().not()).value()\nvar r = $('clsa-dcs.Participants:Admin.StageInstance.stage').any('Blood2').and(v.isNull().not()).value()\nif(p && !(q || r)) {\n  res = newValue( 'Phlebotomy', 'text') \n} else if(q && !(p || r)) {\n  res = newValue( 'Blood', 'text') \n} else if(r && !(p || q)) {\n  res = newValue( 'Blood2', 'text') \n} else if(p || q || r) {\n  var s=[]\n  var n = ['Phlebotomy','Blood','Blood2']\n  if(p) s.push(u)\n  if(q) s.push(v)\n  if(r) s.push(w)\n  var x = []\n  var y = []\n  for(var i = 0; i < s.length; i++) {\n    if(s[i].any('Completed').value()) x.push(n[i])\n    if(s[i].any('NotApplicable').value()) y.push(n[i])\n  }\n  if(0 < x.length) {\n    res = newValue(x[x.length-1],'text')\n  } else if(0 < y.length) {\n    res = newValue(y[y.length-1],'text')\n  }\n}\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_other","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'Consent'\n]\n$('clsa-dcs.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_carotid","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "// the expected stages in room 1\nroom1_dependent = ['HipsWaist','Weight','SittingHeight','StandingHeight','BloodPressure','ECG','CarotidIntima','Plaque','Spirometry','QuestionnaireBoneDensity']\n\nstages = $('Admin.Action.stage').asSequence().filter(function(v){\n  return -1!=room1_dependent.indexOf(v.value())\n}).filter(function(v,i){\n    return i==this.indexOf(v)\n  }).asSequence()\n  \nvar res = null\nvar i = stages.indexOf('CarotidIntima')\nvar j = i-1\nvar k = i+1\nif( -1<j && k<stages.size().value() ) {\n  var pre = newValue(null, 'datetime')\n  var post = newValue(null, 'datetime')\n  \n  var prev = stages.valueAt(j)\n  var next = stages.valueAt(k)\n  if(-1 != $this('group_questionnaire').indexOf(prev)) {\n    pre = $('clsa-dcs.'+prev+':QuestionnaireRun.timeEnd')      \n  } else if(-1 != $this('group_instrument').indexOf(prev)) {\n    pre = $('clsa-dcs.'+prev+':InstrumentRun.timeEnd')      \n  } else if(-1 != $this('group_other').indexOf(prev)) {\n    pre = $('clsa-dcs.'+prev+':timeEnd') \n  } \n  if(-1 != $this('group_questionnaire').indexOf(next)) {\n    post = $('clsa-dcs.'+next+':QuestionnaireRun.timeStart')\n  } else if(-1 != $this('group_instrument').indexOf(next)) {\n    post = $('clsa-dcs.'+next+':InstrumentRun.timeStart')\n  } else if(-1 != $this('group_other').indexOf(next)) {\n    post = $('clsa-dcs.'+next+':timeStart')\n  }\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n}\n\nif(null == res) {\n  var post = $('clsa-dcs.CarotidIntima:InstrumentRun.timeEnd')\n  var pre = $('clsa-dcs.CarotidIntima:InstrumentRun.timeStart')\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n  if(null == res) {\n    res = $group(\n      'clsa-dcs.Participants:Admin.StageInstance.stage',\n      'CarotidIntima',\n      'Admin.StageInstance.duration').asSequence().sum()\n  }\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""}]}}