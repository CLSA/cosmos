{"from": ["clsa-dcs.Participants","clsa-dcs-images.DualHipBoneDensity","clsa-dcs-images.ForearmBoneDensity","clsa-dcs-images.LateralBoneDensity","clsa-dcs-images.WholeBodyBoneDensity"],"name": "QC_BL_dexa","datasourceName": "cosmos_dcs","Magma.VariableListViewDto.view": {"variables": [{"name": "technician","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "var list = ['LateralBoneDensity','WholeBodyBoneDensity','DualHipBoneDensity','ForearmBoneDensity']\nvar res = null\nfor(var i=0; i<list.length; i++) {\n  var str = $('clsa-dcs-images.'+list[i]+':InstrumentRun.user').whenNull(\n    $group('Admin.Action.stage',list[i],'Admin.Action.user').asSequence().last()).lowerCase()\n  if(str.isNull().not().value()) {\n    var v = str.value()\n    if(0<v.length) {\n      res = newValue(v)\n      break\n    }  \n  }  \n}\nres  "}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "skip","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"unit": "","index": 0,"referencedEntityType": ""},{"name": "contraindicated","entityType": "Participant","valueType": "boolean","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('cosmos_dcs.QC_BL_dexa_lateral:contraindicated').and(\n  $('cosmos_dcs.QC_BL_dexa_whole_body:contraindicated'),\n  $('cosmos_dcs.QC_BL_dexa_forearm:contraindicated'),\n  $('cosmos_dcs.QC_BL_dexa_hip:contraindicated'))"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "missing","entityType": "Participant","valueType": "boolean","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$this('contraindicated').not().and(\n  $this('file_complete').isNull())"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "duration","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('cosmos_dcs.QC_BL_meta:group_duration_dexa')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_name","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "newSequence(['hip_left','hip_right','whole_body','lateral','forearm'])"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_size","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var prefix = 'cosmos_dcs.QC_BL_dexa_'\nvar list = ['hip','whole_body','lateral','forearm']\nvar str = []\nfor(var i=0; i<list.length; i++) {\n  var scan = list[i]  \n  if('hip'==scan) {\n    str.push($(prefix+scan+':file_size').valueAt(0))\n    str.push($(prefix+scan+':file_size').valueAt(1))\n  } else {\n    str.push($(prefix+scan+':file_size'))\n  }\n}\nnewSequence(str,'integer')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_complete","entityType": "Participant","valueType": "decimal","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "var res = null\nif($this('contraindicated').not().value()) {\n  var q = 0\n  q += ($('cosmos_dcs.QC_BL_dexa_lateral:contraindicated').value() ? 0 : 1)\n  q += ($('cosmos_dcs.QC_BL_dexa_whole_body:contraindicated').value() ? 0 : 1)\n  q += ($('cosmos_dcs.QC_BL_dexa_forearm:contraindicated').value() ? 0 : 1)\n  q += ($('cosmos_dcs.QC_BL_dexa_hip:contraindicated').value() ? 0 : 2)\n  res = $this('file_size').trimmer().size().div(q).multiply(100)\n}\nres"}],"unit": "","index": 0,"referencedEntityType": ""}]}}