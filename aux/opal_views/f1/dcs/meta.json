{"from": ["clsa-dcs-f1.Participants","clsa-dcs-f1.ECG","clsa-dcs-f1.4mWalk","clsa-dcs-f1.Blood","clsa-dcs-f1.Blood2","clsa-dcs-f1.ChairRise","clsa-dcs-f1.ConclusionQuestionnaire","clsa-dcs-f1.ContraIndications","clsa-dcs-f1.Deviation_AE_CRF","clsa-dcs-f1.DiseaseSymptoms","clsa-dcs-f1.EventPMT","clsa-dcs-f1.GenHealth","clsa-dcs-f1.HearingQuestionnaire","clsa-dcs-f1.NeuropsychologicalBattery","clsa-dcs-f1.NeuropsychologicalBatteryScoring","clsa-dcs-f1.OSEA","clsa-dcs-f1.OSOnly","clsa-dcs-f1.QualityAssuranceIH","clsa-dcs-f1.QuestionnaireBoneDensity","clsa-dcs-f1.FunctionalStatus","clsa-dcs-f1.StandingBalance","clsa-dcs-f1.TUG","clsa-dcs-f1.TimeBasedProspectiveMemoryTask","clsa-dcs-f1.Urine","clsa-dcs-f1.VisionAcuity","clsa-dcs-f1.BloodPressure","clsa-dcs-images-f1.CarotidIntima","clsa-dcs-f1.CognitiveTest","clsa-dcs-images-f1.DualHipBoneDensity","clsa-dcs-images-f1.ForearmBoneDensity","clsa-dcs-f1.Frax","clsa-dcs-f1.GripStrength","clsa-dcs-f1.Hearing","clsa-dcs-f1.HipsWaist","clsa-dcs-images-f1.LateralBoneDensity","clsa-dcs-images-f1.RetinalScanLeft","clsa-dcs-images-f1.RetinalScanRight","clsa-dcs-f1.StandingHeight","clsa-dcs-images-f1.SpineBoneDensity","clsa-dcs-f1.Spirometry","clsa-dcs-f1.Tonometer","clsa-dcs-f1.Weight","clsa-dcs-images-f1.WholeBodyBoneDensity"],"name": "QC_F1_meta","datasourceName": "cosmos_dcs","Magma.VariableListViewDto.view": {"variables": [{"name": "group_questionnaire","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'4mWalk',\n'Blood',\n'Blood2',\n'ChairRise',\n'ConclusionQuestionnaire',\n'ContraIndications',\n'Deviation_AE_CRF',\n'DiseaseSymptoms',\n'EventPMT',\n'FunctionalStatus',\n'GenHealth',\n'HearingQuestionnaire',\n'NeuropsychologicalBattery',\n'NeuropsychologicalBatteryScoring',\n'OSEA',\n'OSOnly',\n'QualityAssuranceIH',\n'QuestionnaireBoneDensity',\n'StandingBalance',\n'TUG',\n'TimeBasedProspectiveMemoryTask',\n'Urine',\n'VisionAcuity'\n]\n\n$('clsa-dcs-f1.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_instrument","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'BloodPressure',\n'CarotidIntima',\n'CognitiveTest',\n'DualHipBoneDensity',\n'ECG',\n'ForearmBoneDensity',\n'Frax',\n'GripStrength',\n'Hearing',\n'HipsWaist',\n'LateralBoneDensity',\n'RetinalScanLeft',\n'RetinalScanRight',\n'SpineBoneDensity',\n'Spirometry',\n'StandingHeight',\n'Tonometer',\n'Weight',\n'WholeBodyBoneDensity'\n]\n$('clsa-dcs-f1.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_duration_ecg","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "var res = null\nif($('clsa-dcs-f1.ECG:RES_MEASUREMENT_DATE').isNull().not().and(\n   $('clsa-dcs-f1.ECG:RES_MEASUREMENT_TIME').isNull().not()).value()) {\n  var ecg = newValue(\n    $('clsa-dcs-f1.ECG:RES_MEASUREMENT_DATE').value() + ' ' +\n    $('clsa-dcs-f1.ECG:RES_MEASUREMENT_TIME').value(), 'datetime')\n    \n  var ecgTime = ecg.time()\n  var preIndex = -1\n  var postIndex = -1    \n  var pre = newValue(null, 'datetime')\n  var post = newValue(null, 'datetime')\n  var minPre = 10000000000000000\n  var minPost = minPre  \n  var stages = $('clsa-dcs-f1.Participants:Admin.StageInstance.stage').asSequence().filter(function(v) {\n    return v.matches(/ECG/).not().value()\n  })  \n  var times = {'pre':null,'post':null}\n\n  for(var i = 0; i < stages.size(); i++) {\n    var stage = stages.valueAt(i).value()\n    \n    if(-1 != $this('group_questionnaire').indexOf(stage)) {\n      pre = $('clsa-dcs-f1.'+stage+':QuestionnaireRun.timeEnd')      \n    } else if(-1 != $this('group_instrument').indexOf(stage)) {\n      pre = $('clsa-dcs-f1.'+stage+':InstrumentRun.timeEnd')      \n    } else if(-1 != $this('group_other').indexOf(stage)) {\n      pre = $('clsa-dcs-f1.'+stage+':timeEnd') \n    } else {\n      continue\n    }\n    if(ecg.after(pre).value()) {\n      var p = ecgTime.minus(pre.time()).value()\n      if(p < minPre) {\n        minPre = p\n        preIndex = i\n        times['pre'] = pre.time()\n      }        \n    } else {\n      if(-1 != $this('group_questionnaire').indexOf(stage)) {        \n        post = $('clsa-dcs-f1.'+stage+':QuestionnaireRun.timeStart')\n      } else if(-1 != $this('group_instrument').indexOf(stage)) {        \n        post = $('clsa-dcs-f1.'+stage+':InstrumentRun.timeStart')\n      } else if(-1 != $this('group_other').indexOf(stage)) {        \n        post = $('clsa-dcs-f1.'+stage+':timeStart')\n      } else {\n        continue\n      }     \n      if (ecg.before(post).value()) {\n        var p = post.time().minus(ecgTime).value()\n        if(p < minPost) {\n          minPost = p\n          postIndex = i\n          times['post'] = post.time()\n        }\n      }\n    }\n  }\n  if(1<(postIndex-preIndex)) {\n    res = times['post'].minus(times['pre']).div(1000)    \n  }\n}\n\nif(null == res) {\n  var post = $('clsa-dcs-f1.ECG:InstrumentRun.timeEnd')\n  var pre = $('clsa-dcs-f1.ECG:InstrumentRun.timeStart')\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n  if(null == res) {\n    res = $group(\n      'clsa-dcs-f1.Participants:Admin.StageInstance.stage',\n      'ECG',\n      'Admin.StageInstance.duration').asSequence().sum()\n  }\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_duration_dexa","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list = ['LateralBoneDensity','ForearmBoneDensity','WholeBodyBoneDensity','DualHipBoneDensity','SpineBoneDensity']\nvar stages = $('clsa-dcs-f1.Participants:Admin.StageInstance.stage').asSequence()\nvar dexa = stages.filter(function(v) {\n    return -1!=list.indexOf(v.value())\n  })\nvar res = null\nif(dexa.empty().not().value()) {\n  \n  list = list.concat(['QuestionnaireBoneDensity','Frax','EventPMT'])\n  var seq = stages.filter(function(v) {\n    return -1!=list.indexOf(v.value())\n  }).join('').value()\n  \n  var stageAfter = seq.endsWith('FraxEventPMT') ? 'Frax' : 'EventPMT'\n  // bracket the actual bone density acquisitions\n  // \n  var pre = $('clsa-dcs-f1.QuestionnaireBoneDensity:QuestionnaireRun.timeEnd')  \n  var post = -1 != $this('group_questionnaire').indexOf(stageAfter) ?\n    $('clsa-dcs-f1.'+stageAfter+':QuestionnaireRun.timeStart') :\n    $('clsa-dcs-f1.'+stageAfter+':InstrumentRun.timeStart')\n  \n  if(pre.before(post).value()) {    \n    res = post.time().minus(pre.time()).div(1000)\n  }  \n}\n\nif(null == res) {\n  res = newValue(0,'integer')\n  list = ['LateralBoneDensity','ForearmBoneDensity','WholeBodyBoneDensity','DualHipBoneDensity','SpineBoneDensity']\n  list.forEach(function(stage) {\n    var pre = $('clsa-dcs-f1.'+stage+':InstrumentRun.timeEnd')\n    var post = $('clsa-dcs-f1.'+stage+':InstrumentRun.timeStart')  \n    if(pre.before(post).value()) {    \n      res = res.plus(post.time().minus(pre.time()).div(1000))\n    }    \n  })\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_blood","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "var res = null\nvar u = $group('clsa-dcs-f1.Participants:Admin.StageInstance.stage','Blood','Admin.StageInstance.lastState').asSequence().last()\nvar v = $group('clsa-dcs-f1.Participants:Admin.StageInstance.stage','Blood2','Admin.StageInstance.lastState').asSequence().last()\nvar p = $('clsa-dcs-f1.Participants:Admin.StageInstance.stage').any('Blood').and(u.isNull().not()).value()\nvar q = $('clsa-dcs-f1.Participants:Admin.StageInstance.stage').any('Blood2').and(v.isNull().not()).value()\nif(p && !q) {\n  res = newValue( 'Blood', 'text') \n} else if(q && !p) {\n  res = newValue( 'Blood2', 'text') \n} else if(p && q) {\n  if(v.any('NotApplicable').or(u.any('Completed')).value()) {\n    res = newValue('Blood', 'text')\n  } else { \n    res = newValue('Blood2', 'text')\n  }\n}\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_other","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var list=[\n'Consent'\n]\n$('clsa-dcs-f1.Participants:Admin.StageInstance.stage').asSequence().filter(function(v){\n  return -1!=list.indexOf(v.value())\n})"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "group_carotid","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"occurrenceGroup": "","attributes": [{"name": "script","value": "// the expected stages in room 1\nroom1_dependent = ['HipsWaist','Weight','StandingHeight','BloodPressure','ECG','CarotidIntima','Spirometry','QuestionnaireBoneDensity']\n\nstages = $('Admin.Action.stage').asSequence().filter(function(v){\n  return -1!=room1_dependent.indexOf(v.value())\n}).filter(function(v,i){\n    return i==this.indexOf(v)\n  }).asSequence()\n  \nvar res = null\nvar i = stages.indexOf('CarotidIntima')\nvar j = i-1\nvar k = i+1\nif( -1<j && k<stages.size().value() ) {\n  var pre = newValue(null, 'datetime')\n  var post = newValue(null, 'datetime')\n  \n  var prev = stages.valueAt(j)\n  var next = stages.valueAt(k)\n  if(-1 != $this('group_questionnaire').indexOf(prev)) {\n    pre = $('clsa-dcs-f1.'+prev+':QuestionnaireRun.timeEnd')      \n  } else if(-1 != $this('group_instrument').indexOf(prev)) {\n    pre = $('clsa-dcs-f1.'+prev+':InstrumentRun.timeEnd')      \n  } else if(-1 != $this('group_other').indexOf(prev)) {\n    pre = $('clsa-dcs-f1.'+prev+':timeEnd') \n  } \n  if(-1 != $this('group_questionnaire').indexOf(next)) {\n    post = $('clsa-dcs-f1.'+next+':QuestionnaireRun.timeStart')\n  } else if(-1 != $this('group_instrument').indexOf(next)) {\n    post = $('clsa-dcs-f1.'+next+':InstrumentRun.timeStart')\n  } else if(-1 != $this('group_other').indexOf(next)) {\n    post = $('clsa-dcs-f1.'+next+':timeStart')\n  }\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n}\n\nif(null == res) {\n  var post = $('clsa-dcs-f1.CarotidIntima:InstrumentRun.timeEnd')\n  var pre = $('clsa-dcs-f1.CarotidIntima:InstrumentRun.timeStart')\n  if(pre.before(post).value()) {\n    res = post.time().minus(pre.time()).div(1000)\n  }\n  if(null == res) {\n    res = $group(\n      'clsa-dcs-f1.Participants:Admin.StageInstance.stage',\n      'CarotidIntima',\n      'Admin.StageInstance.duration').asSequence().sum()\n  }\n  if(res.eq(0).value()) res = null\n}\n\nres"}],"unit": "","index": 0,"referencedEntityType": ""}]}}