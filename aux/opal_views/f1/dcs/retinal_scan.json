{"from": ["clsa-dcs-f1.Participants","clsa-dcs-images-f1.RetinalScanLeft","clsa-dcs-images-f1.RetinalScanRight","cosmos_dcs.QC_F1_retinal_scan_left","cosmos_dcs.QC_F1_retinal_scan_right"],"name": "QC_F1_retinal_scan","datasourceName": "cosmos_dcs","where": "$('clsa-dcs-f1.Participants:DCSatHOME').not().whenNull(true).and($('clsa-dcs-f1.Participants:DCS_PHONE').not().whenNull(true))","Magma.VariableListViewDto.view": {"variables": [{"name": "technician","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "var list = ['RetinalScanLeft','RetinalScanRight']\nvar res = null\nfor(var i=0; i<list.length; i++) {\n  var str = $('clsa-dcs-images-f1.'+list[i]+':InstrumentRun.user').whenNull(\n    $group('Admin.Action.stage',list[i],'Admin.Action.user').asSequence().last()).lowerCase()\n  if(str.isNull().not().value()) {\n    var v = str.value()\n    if(0<v.length) {\n      res = newValue(v)\n      break\n    }  \n  }  \n}\nres"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "contraindicated","entityType": "Participant","valueType": "boolean","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('cosmos_dcs.QC_F1_retinal_scan_left:contraindicated').and(\n  $('cosmos_dcs.QC_F1_retinal_scan_right:contraindicated'))"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "missing","entityType": "Participant","valueType": "boolean","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$this('contraindicated').not().and(\n  $this('skip_value').trimmer().isNull(),\n  $this('file_complete').isNull())"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "duration","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$('cosmos_dcs.QC_F1_retinal_scan_left:duration').plus(\n  $('cosmos_dcs.QC_F1_retinal_scan_right:duration'))"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_name","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "newSequence(['retinal_scan_left','retinal_scan_right'])"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_size","entityType": "Participant","valueType": "integer","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "newSequence([$('cosmos_dcs.QC_F1_retinal_scan_left:file_size'),$('cosmos_dcs.QC_F1_retinal_scan_right:file_size')],'integer')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "file_complete","entityType": "Participant","valueType": "decimal","mimeType": "","isRepeatable": false,"attributes": [{"name": "script","value": "$this('file_size').trimmer().size().div($this('file_name').size()).multiply(100)"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "skip_name","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "newSequence(['InterviewerDecision',\n'ParticipantDecision',\n'SeeComment',\n'TechnicalProblem'],'text')\n\t\t\t\t\t"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "skip_value","entityType": "Participant","valueType": "boolean","mimeType": "","isRepeatable": true,"occurrenceGroup": "","attributes": [{"name": "script","value": "var stages = ['RetinalScanLeft','RetinalScanRight']\nvar arr = []\nfor(var i=0; i < $this('skip_name').size(); i++) {\n  arr.push(null)\n}\nstages.forEach(function(stage) {\n  var action = $group('Admin.Action.stage',stage,'Admin.Action.actionType').asSequence()\n  var type = $group('Admin.Action.stage',stage,'Admin.Action.eventReason').asSequence().filter(function(v,i){\n    return i == action.indexOf('SKIP')\n    }).last().whenNull('').value().slice(14)\n  \n  for(var i=0; i < $this('skip_name').size(); i++) {\n    arr[i] = $this('skip_name').valueAt(i).eq(type).value()?true:arr[i]\n  }\n})  \nnewSequence(arr,'boolean')"}],"unit": "","index": 0,"referencedEntityType": ""},{"name": "comment","entityType": "Participant","valueType": "text","mimeType": "","isRepeatable": false,"unit": "","index": 0,"referencedEntityType": ""}]}}